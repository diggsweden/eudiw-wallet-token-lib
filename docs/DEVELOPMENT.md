# Development Guide

## Table of Contents

- [Setup and Configuration](#setup-and-configuration)
  - [Prerequisites](#prerequisites)
  - [Quick Start](#quick-start)
- [Development Workflow](#development-workflow)
  - [Available Commands](#available-commands)
  - [Code Quality](#code-quality)
- [IDE Setup](#ide-setup)
- [Build](#build)
- [Consuming SNAPSHOTS](#consuming-snapshots-from-maven-central)
- [Release Process](#release-process)

## Setup and Configuration

### Prerequisites - Linux

1. Install [mise](https://mise.jdx.dev/) (manages linting tools):

   ```bash
   curl https://mise.run | sh
   ```

2. Activate mise in your shell:

   ```bash
   # For bash - add to ~/.bashrc
   eval "$(mise activate bash)"

   # For zsh - add to ~/.zshrc
   eval "$(mise activate zsh)"

   # For fish - add to ~/.config/fish/config.fish
   mise activate fish | source
   ```

   Then restart your terminal.

3. Install pipx (needed for reuse license linting):

   ```bash
   # Debian/Ubuntu
   sudo apt install pipx
   ```

4. Install project tools:

   ```bash
   mise install
   ```

### Prerequisites - macOS

1. Install [mise](https://mise.jdx.dev/) (manages linting tools):

   ```bash
   brew install mise
   ```

2. Activate mise in your shell:

   ```bash
   # For zsh - add to ~/.zshrc
   eval "$(mise activate zsh)"

   # For bash - add to ~/.bashrc
   eval "$(mise activate bash)"

   # For fish - add to ~/.config/fish/config.fish
   mise activate fish | source
   ```

   Then restart your terminal.

3. Install newer bash than macOS default:

   ```bash
   brew install bash
   ```

4. Install pipx (needed for reuse license linting):

   ```bash
   brew install pipx
   ```

5. Install project tools:

   ```bash
   mise install
   ```

### Quick Start

```shell
# Install all development tools
mise install

# Show all tasks
just

# Setup shared linting tools
just setup-devtools

# Run all quality checks
just verify
```

## Development Workflow

### Available Commands

Run `just` to see all available commands. Key commands:

| Command | Description |
|---------|-------------|
| `just verify` | Run all checks (lint + test) |
| `just lint-all` | Run all linters |
| `just lint-fix` | Auto-fix linting issues |
| `just test` | Run tests (mvn verify) |
| `just build` | Build project |
| `just clean` | Clean build artifacts |

#### Linting Commands

| Command | Tool | Description |
|---------|------|-------------|
| `just lint-commits` | conform | Validate commit messages |
| `just lint-secrets` | gitleaks | Scan for secrets |
| `just lint-yaml` | yamlfmt | Lint YAML files |
| `just lint-markdown` | rumdl | Lint markdown files |
| `just lint-shell` | shellcheck | Lint shell scripts |
| `just lint-shell-fmt` | shfmt | Check shell formatting |
| `just lint-actions` | actionlint | Lint GitHub Actions |
| `just lint-license` | reuse | Check license compliance |
| `just lint-java` | Maven | Run all Java linters |
| `just lint-java-checkstyle` | checkstyle | Java style checks |
| `just lint-java-pmd` | pmd | Java static analysis |
| `just lint-java-spotbugs` | spotbugs | Java bug detection |
| `just lint-java-fmt` | formatter | Check Java formatting |

#### Fix Commands

| Command | Description |
|---------|-------------|
| `just lint-yaml-fix` | Fix YAML formatting |
| `just lint-markdown-fix` | Fix markdown formatting |
| `just lint-shell-fmt-fix` | Fix shell formatting |
| `just lint-java-fmt-fix` | Fix Java formatting |

### Code Quality

Run all quality checks before submitting a PR:

```shell
# Run all checks
just verify

# Or run linting only
just lint-all

# Auto-fix where possible
just lint-fix
```

## IDE Setup

### VSCode

1. Install [Checkstyle For Java](https://marketplace.visualstudio.com/items?itemName=shengchen.vscode-checkstyle)
2. Open workspace settings (Ctrl+Shift+P → Preferences: Workspace Settings (JSON)) and add:

    ```json
    "[java]": {
        "editor.defaultFormatter": "redhat.java"
    },
    "java.format.settings.url": "development/format/eclipse-java-google-style.xml",
    "java.format.settings.profile": "GoogleStyle",
    "editor.formatOnSave": true,
    "java.checkstyle.configuration": "development/lint/google_checks.xml",
    "java.checkstyle.version": "10.25.0"
    ```

### IntelliJ

1. **Code Style**
   - Settings → `Editor → Code Style → Java`
   - Click gear → `Import Scheme → Eclipse XML Profile`
   - Select `development/format/eclipse-java-google-style.xml`

2. **Checkstyle**
   - Install "CheckStyle-IDEA" plugin
   - Settings → `Tools → Checkstyle`
   - Click the built-in Google Style Check

## Build

```shell
# Using just
just build

# Or using Maven directly
mvn clean verify
```

## Consuming SNAPSHOTS from Maven Central

Configure your pom.xml file with:

```xml
<repositories>
  <repository>
    <name>Central Portal Snapshots</name>
    <id>central-portal-snapshots</id>
    <url>https://central.sonatype.com/repository/maven-snapshots/</url>
    <releases>
      <enabled>false</enabled>
    </releases>
    <snapshots>
      <enabled>true</enabled>
    </snapshots>
  </repository>
</repositories>
```

## Release Process

Releases to Maven Central can be done via CI or locally.

### Prerequisites

1. **For CI releases**:
   - Push access to the repository (ability to push tags)
   - For production releases: Your GitHub username in AUTHORIZED_RELEASE_DEVELOPERS list
   - For SNAPSHOT releases: Any contributor with tag push access

2. **For local releases only**:
   - Valid GPG key pair for signing artifacts
   - GPG key uploaded to key servers (e.g., `keyserver.ubuntu.com`)
   - Maven Central credentials in settings.xml

### CI Release Process

1. **For SNAPSHOT releases**:

   ```shell
   # Tag with -SNAPSHOT suffix (use -f to force if tag already exists)
   git tag -sf v0.0.3-SNAPSHOT -m 'v0.0.3-SNAPSHOT'
   # Push the tag to trigger the CI workflow (use -f to force update on remote)
   git push -f origin tag v0.0.3-SNAPSHOT
   ```

   > **NOTE**: Always use the same SNAPSHOT tag version until ready for a production release.

2. **For Production releases**:

   ```shell
   # Tag with the desired version (no SNAPSHOT suffix)
   git tag -s v1.0.0 -m 'v1.0.0'
   # Push the tag to trigger the CI workflow
   git push origin tag v1.0.0
   ```

   > **NOTE**: The tag version will be used in the POM file.

3. **Monitor the workflow** in GitHub Actions to ensure successful completion.

### Local Release Process

1. **Configure settings.xml**:
   - Ensure `.mvn/settings.xml` contains your Maven Central username and token
   - Verify credentials are in the correct server section with the proper server ID
   - Make sure your GPG key is available in your environment

2. **Run the deploy command**:

   ```shell
   mvn deploy --settings .mvn/settings.xml -Pcentral-release
   ```

3. **Verify the release** in your Sonatype account or Maven Central.

### Troubleshooting

- For CI failures: Check "jreleaser-logs" artifact for detailed error information
- For authorization issues: Verify your GitHub username is in AUTHORIZED_RELEASE_DEVELOPERS
- For GPG problems: Ensure your key is correctly configured in your environment
