# SPDX-FileCopyrightText: 2025 diggsweden/eudiw-wallet-token-lib
#
# SPDX-License-Identifier: CC0-1.0

# Release Workflow for token-lib
# Uses the unified release orchestrator with Maven library publisher
name: Release Workflow

on:
  push:
    tags:
      - "v[0-9]+.[0-9]+.[0-9]+" # Stable: v1.0.0
      - "v[0-9]+.[0-9]+.[0-9]+-SNAPSHOT*" # Snapshot: v1.0.0-SNAPSHOT

concurrency:
  group: release-${{ github.ref }}
  cancel-in-progress: false # Queue releases, don't cancel partial releases

permissions:
  contents: read # Best Security practice. Jobs only get read as base, and then permissions are added as needed

jobs:
  release:
    uses: diggsweden/reusable-ci/.github/workflows/release-orchestrator.yml@e1e1387d5b0399bb5edb00e40485746772344176 # v2.6.0
    permissions:
      contents: write # Create GitHub releases and tags
      packages: write # Publish to GitHub Packages (backup)
      id-token: write # Generate OIDC token for Maven Central
      actions: read # Needed by SLSA provenance
      attestations: write # Needed by SBOM attestation
      security-events: write # Needed by container scan (N/A for libs)
    secrets: inherit # Use org-level MAVEN_CENTRAL credentials, GPG keys, and AUTHORIZED_RELEASE_DEVELOPERS
    with:
      # Artifacts configuration
      artifacts-config: .github/artifacts.yml

      # Changelog configuration
      changelog-creator: git-cliff

      # Release configuration
      release-publisher: github-cli
      release.checkauthorization: true
